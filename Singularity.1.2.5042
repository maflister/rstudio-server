BootStrap: shub
From: mcw-rcc/r-base:3.5.0

%help
    This container runs RStudio-Server.

%labels
    Maintainer Matthew Flister

%apprun rserver
    exec rserver "${@}"

%runscript
    exec rserver "${@}"

%environment
    export QT_XKB_CONFIG_ROOT=/usr/share/X11/xkb
    export PATH=/usr/lib/rstudio-server/bin:${PATH}

%setup
    install -Dv \
    pam_help.sh \
    ${SINGULARITY_ROOTFS}/usr/lib/rstudio-server/bin/pam_help
    install -Dv \
    rserver.conf \
    ${SINGULARITY_ROOTFS}/etc/rstudio/rserver.conf

%post
    mkdir -p /mod/l /mod/s /mod/r
    cat <<EOF >> /usr/share/Modules/init/.modulespath
    /mod/l
    /mod/s
    /mod/r
    EOF
    yum install -y environment-modules
    wget https://download2.rstudio.org/server/centos6/x86_64/rstudio-server-rhel-1.2.5042-x86_64.rpm
    yum install -y rstudio-server-rhel-1.2.5042-x86_64.rpm
    rm -rf rstudio-server-rhel-1.2.5042-x86_64.rpm
    echo "R_LIBS=/extR/library1:/extR/library2" > /usr/local/lib/R/etc/Renviron.site
    yum clean all
%test
    rstudio-server verify-installation

